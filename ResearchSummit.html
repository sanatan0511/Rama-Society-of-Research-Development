<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sanatan's Lab - Code Compiler</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ext-language_tools.js"></script>
  <style>
    /* General styles for both light and dark modes */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f7f7f7;
      color: #333;
      transition: background-color 0.3s, color 0.3s;
    }

    .dark-mode {
      background-color: #333;
      color: #f0f0f0;
    }

    /* Login Page Styling */
    #loginPage {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, #4CAF50, #8BC34A); /* Gradient background */
    }

    #loginPage h2 {
      font-size: 32px;
      color: white;
      margin-bottom: 30px;
    }

    #loginPage input {
      padding: 15px;
      margin: 10px 0;
      font-size: 18px;
      width: 350px;
      border-radius: 25px;
      border: 2px solid #ddd;
      transition: all 0.3s ease;
    }

    #loginPage input:focus {
      border-color: #4CAF50;
      outline: none;
    }

    #loginPage button {
      padding: 15px;
      font-size: 18px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      width: 370px;
      transition: background-color 0.3s ease;
    }

    #loginPage button:hover {
      background-color: #45a049;
    }

    /* Code Editor Page Styling */
    #editor {
      height: 80vh;  /* Adjusted height for the editor */
      width: 100%;   /* Full width */
      margin-top: 20px;
      border-radius: 8px;
    }

    select, button {
      margin: 10px 0;
      padding: 12px;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }

    pre {
      background: #111;
      color: #0f0;
      padding: 10px;
      text-align: left;
      overflow-x: auto;
      white-space: pre-wrap;
      margin-top: 10px;
      font-size: 14px;
    }

    .badge {
      display: inline-block;
      background-color: #4CAF50;
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      margin: 5px;
      font-size: 14px;
    }

    #liveOutput {
      width: 100%;
      height: 300px;
      border: 1px solid #ccc;
      margin-top: 10px;
    }

    #userInput {
      width: 90%;
      padding: 12px;
      font-size: 16px;
      margin-top: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      height: 200px;  /* Increased height for better input space */
      resize: vertical;
    }

    .toggle-mode {
      background-color: #4CAF50;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 20px;
      position: absolute;
      top: 20px;
      right: 30px;
    }

    /* Sample Code for Editor */
    .sample-code {
      font-size: 14px;
      color: #333;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
  </style>
</head>
<body>

<!-- Toggle Dark/Light Mode -->
<button class="toggle-mode" onclick="toggleMode()">Switch to Dark Mode</button>

<!-- Login Page -->
<div id="loginPage">
  <h2>Login to Sanatan's Lab</h2>
  <input type="text" id="userid" placeholder="User ID" required><br><br>
  <input type="password" id="password" placeholder="Password" required><br><br>
  <button onclick="loginUser()">Login</button>
</div>

<!-- Code Editor Page -->
<div id="editorPage" class="container" style="display:none;">
  <h1>Welcome to Sanatan's Lab</h1>

  <!-- Language Selection -->
  <label for="language">Choose Language:</label>
  <select id="language" onchange="changeLanguage()">
    <option value="python3">Python</option>
    <option value="java">Java</option>
    <option value="javascript">JavaScript</option>
    <option value="html">HTML</option>
    <option value="css">CSS</option>
    <option value="c">C</option>
    <option value="cpp">C++</option>
  </select><br>

  <!-- Ace Editor for Code Writing -->
  <div id="editor"></div><br>

  <!-- User Input Section -->
  <label for="userInput">Input (for your code if needed):</label><br>
  <textarea id="userInput" placeholder="Enter input here..." rows="6" cols="60"></textarea><br>

  <button onclick="runCode()">Run Code</button>

  <h3>Output:</h3>
  <pre id="output"></pre>

  <div id="liveOutput"></div>

  <div id="badges">
    <h3>Achievements:</h3>
    <span class="badge" id="badge1" style="display:none;">First Code Run</span>
  </div>

</div>

<script>
  let isDarkMode = false;
  let editor;

  // Toggle Dark/Light Mode
  function toggleMode() {
    isDarkMode = !isDarkMode;
    document.body.classList.toggle("dark-mode", isDarkMode);
    const modeText = isDarkMode ? "Switch to Light Mode" : "Switch to Dark Mode";
    document.querySelector(".toggle-mode").textContent = modeText;
  }

  // Login functionality with basic input validation
  function loginUser() {
    const user = document.getElementById("userid").value;
    const pass = document.getElementById("password").value;

    // Simple validation to ensure fields are not empty
    if (user === "" || pass === "") {
      alert("Both User ID and Password are required!");
      return;
    }

    // Hardcoded login credentials
    if (user === "admin" && pass === "1234") {
      document.getElementById("loginPage").style.display = "none";
      document.getElementById("editorPage").style.display = "block";
      initializeEditor();
    } else {
      alert("Invalid credentials. Try admin/1234");
    }
  }

  // Initialize Ace Editor
  function initializeEditor() {
    editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/python"); // Default to Python
    editor.setOptions({
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });

    // Sample code for the editor (adjustable)
    const sampleCode = `
# Sample Python Code
print("Hello, World!")

def greet(name):
    print(f"Hello, {name}!")
greet("Sanatan")
    `;
    editor.setValue(sampleCode);
  }

  // Change language in editor
  function changeLanguage() {
    const language = document.getElementById("language").value;
    switch (language) {
      case "python3":
        editor.session.setMode("ace/mode/python");
        break;
      case "java":
        editor.session.setMode("ace/mode/java");
        break;
      case "javascript":
        editor.session.setMode("ace/mode/javascript");
        break;
      case "html":
        editor.session.setMode("ace/mode/html");
        break;
      case "css":
        editor.session.setMode("ace/mode/css");
        break;
      case "c":
        editor.session.setMode("ace/mode/c_cpp");
        break;
      case "cpp":
        editor.session.setMode("ace/mode/c_cpp");
        break;
    }
  }

  // Running the code
  async function runCode() {
    const code = editor.getValue();
    const language = document.getElementById("language").value;
    const userInput = document.getElementById("userInput").value;
    const output = document.getElementById("output");

    output.textContent = "Running...";

    if (language === "html" || language === "css" || language === "javascript") {
      updateLivePreview(code, language);
    } else {
      const response = await fetch("https://emkc.org/api/v2/piston/execute", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          language: language,
          version: "*",
          files: [{ content: code }],
          stdin: userInput
        })
      });

      const result = await response.json();
      output.textContent = result.run.stdout || result.run.stderr || "No output";
    }

    document.getElementById("badge1").style.display = "inline-block";
  }

  // Update live preview for HTML/CSS/JS
  function updateLivePreview(code, language) {
    const iframe = document.getElementById('liveOutput');
    const doc = iframe.contentDocument || iframe.contentWindow.document;
    doc.open();

    if (language === "html") {
      doc.write(code);
    } else if (language === "css") {
      const styleTag = doc.createElement('style');
      styleTag.textContent = code;
      doc.head.appendChild(styleTag);
    } else if (language === "javascript") {
      const scriptTag = doc.createElement('script');
      scriptTag.textContent = code;
      doc.body.appendChild(scriptTag);
    }
    doc.close();
  }
</script>

</body>
</html>
